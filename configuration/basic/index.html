<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.98.0"><meta name=generator content="Relearn 5.12.3+tip"><meta name=description content><meta name=author content="Choria Project"><title>Basic Configuration :: Choria Stream Replicator</title><link href=https://choria-io.github.io/stream-replicator/configuration/basic/index.xml rel=alternate type=application/rss+xml title="Basic Configuration :: Choria Stream Replicator"><link href=https://choria-io.github.io/stream-replicator/css/fontawesome-all.min.css?1682352722 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://choria-io.github.io/stream-replicator/css/fontawesome-all.min.css?1682352722 rel=stylesheet></noscript><link href=https://choria-io.github.io/stream-replicator/css/nucleus.css?1682352722 rel=stylesheet><link href=https://choria-io.github.io/stream-replicator/css/auto-complete.css?1682352722 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://choria-io.github.io/stream-replicator/css/auto-complete.css?1682352722 rel=stylesheet></noscript><link href=https://choria-io.github.io/stream-replicator/css/perfect-scrollbar.min.css?1682352722 rel=stylesheet><link href=https://choria-io.github.io/stream-replicator/css/fonts.css?1682352722 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://choria-io.github.io/stream-replicator/css/fonts.css?1682352722 rel=stylesheet></noscript><link href=https://choria-io.github.io/stream-replicator/css/theme.css?1682352722 rel=stylesheet><link href=https://choria-io.github.io/stream-replicator/css/theme-choria-relearn.css?1682352722 rel=stylesheet id=variant-style><link href=https://choria-io.github.io/stream-replicator/css/variant.css?1682352722 rel=stylesheet><link href=https://choria-io.github.io/stream-replicator/css/print.css?1682352722 rel=stylesheet media=print><link href=https://choria-io.github.io/stream-replicator/css/ie.css?1682352722 rel=stylesheet><script src=https://choria-io.github.io/stream-replicator/js/url.js?1682352722></script>
<script src=https://choria-io.github.io/stream-replicator/js/variant.js?1682352722></script>
<script>window.index_json_url="https://choria-io.github.io/stream-replicator/index.json";var root_url="https://choria-io.github.io/stream-replicator/",baseUriFull,baseUri=root_url.replace(/\/$/,'');window.T_Copy_to_clipboard="Copy to clipboard",window.T_Copied_to_clipboard="Copied to clipboard!",window.T_Copy_link_to_clipboard="Copy link to clipboard",window.T_Link_copied_to_clipboard="Copied link to clipboard!",window.T_No_results_found="No results found for \u0022{0}\u0022",window.T_N_results_found="{1} results found for \u0022{0}\u0022",baseUriFull="https://choria-io.github.io/stream-replicator/",window.variants&&variants.init(["choria-relearn"])</script></head><body class="mobile-support html disableInlineCopyToClipboard" data-url=https://choria-io.github.io/stream-replicator/configuration/basic/index.html><div id=body class=default-animation><div id=sidebar-overlay></div><div id=toc-overlay></div><nav id=topbar class=highlightable><div><div class=navigation><a class="nav nav-next topbar-link" href=https://choria-io.github.io/stream-replicator/configuration/all/index.html title="Copying All Data (&#129106;)"><i class="fas fa-chevron-right fa-fw"></i></a></div><div class=navigation><a class="nav nav-prev topbar-link" href=https://choria-io.github.io/stream-replicator/configuration/index.html title="Configuration (&#129104;)"><i class="fas fa-chevron-left fa-fw"></i></a></div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle class=topbar-link title="Menu (CTRL+ALT+n)"><i class="fas fa-bars fa-fw"></i></a></span>
<span id=toc-menu title="Table of Contents (CTRL+ALT+t)"><i class="fas fa-list-alt fa-fw"></i></span><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=https://choria-io.github.io/stream-replicator/index.html><span itemprop=name>Choria Stream Replicator</span></a><meta itemprop=position content="1">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=https://choria-io.github.io/stream-replicator/configuration/index.html><span itemprop=name>Configuration</span></a><meta itemprop=position content="2">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Basic Configuration</span><meta itemprop=position content="3"></li></ol></div><div class="default-animation progress"><div class=toc-wrapper><nav id=TableOfContents><ul><li><a href=#placement-architecture>Placement Architecture</a></li><li><a href=#requirements>Requirements</a></li><li><a href=#basic-configuration>Basic Configuration</a></li><li><a href=#nats-credentials>NATS Credentials</a></li><li><a href=#tls>TLS</a></li><li><a href=#choria-jwt-tokens>Choria JWT Tokens</a></li></ul></nav></div></div></div></nav><main id=body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><div id=head-tags></div><article class=default><h1 id=basic-configuration>Basic Configuration</h1><p>This section covers the basic information needed for copying streams from a Source to a Target.</p><h2 id=placement-architecture>Placement Architecture</h2><p>Generally it is best to place the Replicator nearest in terms of network latency to the Target.</p><p>When sampling data or tracking and publishing advisories it should be placed nearest to the Source. Advisories are also only Published to the Source so we&rsquo;d want to give those the best chance of success possible by eliminating network issues.</p><p>See details in each deployment scenario for further details and placement constraints.</p><h2 id=requirements>Requirements</h2><p>Both the Source and Target Stream has to exist before this tool will run. The 2 streams do not need to have the same configuration, for example one can keep data for an hour the other for a month. Or one can be Memory based while the other File.</p><p>If the Source does not exist the Replicator will keep trying until it does and then start. If the Target does not exist once the Source is found the Target will be created using the same configuration as the Source.</p><p>For now, we assume like-for-like streams in 2 separate servers.</p><h2 id=basic-configuration>Basic Configuration</h2><p>The Stream Replicator itself has some configuration to set, this is going to be the same for all modes of copy.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>US-EAST</span>
</span></span><span style=display:flex><span><span style=color:#f92672>monitor_port</span>: <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span><span style=color:#f92672>loglevel</span>: <span style=color:#ae81ff>info</span>
</span></span><span style=display:flex><span><span style=color:#f92672>state_store</span>: <span style=color:#ae81ff>/var/lib/stream-replicator</span>
</span></span><span style=display:flex><span><span style=color:#f92672>logfile</span>: <span style=color:#ae81ff>/var/log/stream-replicator.log</span>
</span></span><span style=display:flex><span><span style=color:#f92672>streams</span>: [] <span style=color:#75715e># see other documentation pages</span>
</span></span></code></pre></div><p>This is fairly self-explanatory except for the <code>name</code> property: typically one would deploy a tree-like structure of many Streams replicated into one, perhaps many data centers all having node events.</p><p>To assist with configuration all of these locations would have the same Stream name and same subjects. But centrally one might want to know where a specific message is from.</p><p>Setting a unique per-location name like <code>US-EAST</code> will add a header to every copied message that will include this name.</p><p>Loglevels can be <code>debug</code>, <code>info</code> (default) or <code>warn</code> and if <code>monitor_port</code> is not set (default) Prometheus metrics will not be exposed.</p><p>The remaining settings is obvious and match what is in the RPM packages.</p><h2 id=nats-credentials>NATS Credentials</h2><p>We support using NATS credentials, JWT and NKey files for authentication by adding parameters to any nats source or target urls:</p><table><thead><tr><th>Description</th><th>Example</th></tr></thead><tbody><tr><td>Username and password</td><td><code>nats://user:pass@example.net:4222</code></td></tr><tr><td>Credentials file</td><td><code>nats://example.net:4222?credentials=/path/to/creds</code></td></tr><tr><td>JWT and NKey files</td><td><code>nats://example.net:4222?jwt=/path/to/my.jwt&nkey=/path/to/my.nk</code></td></tr></tbody></table><h2 id=tls>TLS</h2><p>TLS is supported, one can have per Target or Source settings. Per Stream settings or per Replicator settings. The most specific will be used for example, given this partial configuration file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>tls</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ca</span>: <span style=color:#ae81ff>/path/to/ca.pem</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>cert</span>: <span style=color:#ae81ff>/path/to/cert.pem</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>key</span>: <span style=color:#ae81ff>/path/to/key.pem</span>
</span></span><span style=display:flex><span><span style=color:#f92672>streams</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>first</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>target_tls</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ca</span>: <span style=color:#ae81ff>/path/to/first-ca.pem</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cert</span>: <span style=color:#ae81ff>/path/to/first-cert.pem</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>key</span>: <span style=color:#ae81ff>/path/to/first-key.pem</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>second</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>target_tls</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ca</span>: <span style=color:#ae81ff>/path/to/second-ca.pem</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cert</span>: <span style=color:#ae81ff>/path/to/second-cert.pem</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>key</span>: <span style=color:#ae81ff>/path/to/second-key.pem</span>
</span></span><span style=display:flex><span> 
</span></span></code></pre></div><p>Here we have a Replicator-wide default referencing <code>ca.pem</code>, <code>cert.pem</code> and <code>key.pem</code>. All Sources will use this, all Targets without <code>target_tls</code> will use this. But those targets with specific ones will use those.</p><p>This is based on the assumption that one might copy many data from 1 single JetStream server to many locations. This model allows one to state the source TLS once only for all streams.</p><p>Source specific TLS can be set with <code>source_tls</code>. At a Stream level one can also set <code>tls</code> to have the same TLS settings used for Source and Target.</p><h2 id=choria-jwt-tokens>Choria JWT Tokens</h2><p>Choria Broker supports running in a mode that requires Choria specific JWT tokens and private keys in order to connect to it. Replicator supports these. One can have per Target or Source settings. Per Stream settings or per Replicator settings. The most specific will be used for example, given this partial configuration file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>choria</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>seed_file</span>: <span style=color:#ae81ff>/etc/stream-replicator/choria.seed</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>jwt_file</span>: <span style=color:#ae81ff>/etc/stream-replicator/choria.jwt</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>collective</span>: <span style=color:#ae81ff>choria</span>
</span></span><span style=display:flex><span><span style=color:#f92672>streams</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>first</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>target_choria</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>seed_file</span>: <span style=color:#ae81ff>/etc/stream-replicator/first.seed</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>jwt_file</span>: <span style=color:#ae81ff>/etc/stream-replicator/first.jwt</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>collective</span>: <span style=color:#ae81ff>choria</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>second</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>target_choria</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>seed_file</span>: <span style=color:#ae81ff>/etc/stream-replicator/second.seed</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>jwt_file</span>: <span style=color:#ae81ff>/etc/stream-replicator/second.jwt</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>collective</span>: <span style=color:#ae81ff>choria </span>
</span></span></code></pre></div><p>Here we have a Replicator-wide default referencing <code>choria.seed</code>, <code>choria.jwt</code> and <code>choria</code> collective. All Sources will use this, all Targets without <code>target_tls</code> will use this. But those targets with specific ones will use those.</p><p>This is based on the assumption that one might copy many data from 1 single JetStream server to many locations. This model allows one to state the source connection details once only for all streams.</p><p>Source specific Choria connection details can be set with <code>source_choria</code>. At a Stream level one can also set <code>choria</code> to have the same TLS settings used for Source and Target.</p><footer class=footline></footer></article></div></main></div><aside id=sidebar class=default-animation><div id=header-wrapper class=default-animation><div id=header class=default-animation><img src=https://choria-io.github.io/stream-replicator/logo.png></div><div class="searchbox default-animation"><i class="fas fa-search" title="Search (CTRL+ALT+f)"></i>
<label class=a11y-only for=search-by>Search</label>
<input data-search-input id=search-by name=search-by class=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script>var contentLangs=[]</script><script src=https://choria-io.github.io/stream-replicator/js/auto-complete.js?1682352722 defer></script>
<script src=https://choria-io.github.io/stream-replicator/js/lunr/lunr.min.js?1682352722 defer></script>
<script src=https://choria-io.github.io/stream-replicator/js/lunr/lunr.stemmer.support.min.js?1682352722 defer></script>
<script src=https://choria-io.github.io/stream-replicator/js/lunr/lunr.multi.min.js?1682352722 defer></script>
<script src=https://choria-io.github.io/stream-replicator/js/search.js?1682352722 defer></script></div><div id=content-wrapper class=highlightable><ul class="topics enlarge morespace"><li data-nav-id=/installation/index.html><a class=padding href=https://choria-io.github.io/stream-replicator/installation/index.html><b>1. </b>Installation</a></li><li data-nav-id=/configuration/index.html class="parent alwaysopen"><a class=padding href=https://choria-io.github.io/stream-replicator/configuration/index.html><b>2. </b>Configuration</a><ul id=subsections-632bb56b075027697eb90eb7e3d29a12 class=morespace><li data-nav-id=/configuration/basic/index.html class=active><a class=padding href=https://choria-io.github.io/stream-replicator/configuration/basic/index.html><b>2.1. </b>Basic Configuration</a></li><li data-nav-id=/configuration/all/index.html><a class=padding href=https://choria-io.github.io/stream-replicator/configuration/all/index.html><b>2.2. </b>Copying All Data</a></li><li data-nav-id=/configuration/sampling/index.html><a class=padding href=https://choria-io.github.io/stream-replicator/configuration/sampling/index.html><b>2.3. </b>Copying Samples of Data</a></li><li data-nav-id=/configuration/clustering/index.html><a class=padding href=https://choria-io.github.io/stream-replicator/configuration/clustering/index.html><b>2.4. </b>HA Clustering</a></li><li data-nav-id=/configuration/choria_registration/index.html><a class=padding href=https://choria-io.github.io/stream-replicator/configuration/choria_registration/index.html><b>2.5. </b>Choria Registration Data</a></li></ul></li><li data-nav-id=/monitoring/index.html><a class=padding href=https://choria-io.github.io/stream-replicator/monitoring/index.html><b>4. </b>Monitoring</a></li></ul><div id=shortcuts><div class="nav-title padding">More</div><ul class=space><li><a class=padding href=https://github.com/choria-io/stream-replicator><i class="fab fa-fw fa-github"></i> GitHub</a></li><li><a class=padding href=https://github.com/choria-io/stream-replicator/releases><i class="far fa-save"></i> Download</a></li><li><a class=padding href=https://github.com/choria-io/general/discussions><i class="far fa-comments"></i> Discussions</a></li><li><a class=padding href=https://github.com/choria-io/stream-replicator/issues><i class="far fa-life-ring"></i> Issues</a></li><li><a class=padding href=https://slack.puppet.com/><i class="fab fa-slack"></i> #choria</a></li></ul></div><div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"></div><hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"><div id=prefooter class="footerLangSwitch footerVariantSwitch footerVisitedLinks"><ul><li id=select-language-container class=footerLangSwitch><div class="padding select-container"><i class="fas fa-language fa-fw"></i>
<span>&nbsp;</span><div class=select-style><label class=a11y-only for=select-language>Language</label>
<select id=select-language onchange="location=baseUri+this.value"></select></div><div class=select-clear></div></div></li><li id=select-variant-container class=footerVariantSwitch><div class="padding select-container"><i class="fas fa-paint-brush fa-fw"></i>
<span>&nbsp;</span><div class=select-style><label class=a11y-only for=select-variant>Theme</label>
<select id=select-variant onchange=window.variants&&variants.changeVariant(this.value)><option id=choria-relearn value=choria-relearn selected>Choria Relearn</option></select></div><div class=select-clear></div></div><script>window.variants&&variants.markSelectedVariant()</script></li><li class=footerVisitedLinks><button class=padding onclick=clearHistory()><i class="fas fa-history fa-fw"></i><span>&nbsp;</span>Clear History</button></li></ul></div><div id=footer class="footerFooter showFooter"><style>#footer{font-size:13px;height:100px;margin-left:auto;margin-right:auto;padding:2rem 1rem;text-align:center;min-width:230px;max-width:300px}#footer p{margin:0}</style><p>Hosted at <a href=https://github.com/choria-io>GitHub</a> by <a href=https://www.devco.net/>R.I. Pienaar</a></p></div></div></aside><script src=https://choria-io.github.io/stream-replicator/js/clipboard.min.js?1682352722 defer></script>
<script src=https://choria-io.github.io/stream-replicator/js/perfect-scrollbar.min.js?1682352722 defer></script>
<script src=https://choria-io.github.io/stream-replicator/js/theme.js?1682352722 defer></script></body></html>